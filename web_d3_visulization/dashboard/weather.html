<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VizBike@Pittsburgh</title>

    <!-- Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">

.legend{
    color:grey;
    font-size:12px;
    font-weight: bold;
    font-family: Verdana;
    padding-left:50px;
    padding-top: 200px;
    line-height:25pt;
}

#pieChart {
  position:absolute;
  top:170px;
  left:220px;
  width:400px;
  height: 400px;
}

#title1 {
  font-family: Verdana;
  fill:grey;
  font-size:11px;
  font-weight: bold;

}

#lineChart {
  position:absolute;
  top:190px;
  left:640px;
  height: 150px;
}

#barChart {
  position:absolute;
  top:320px;
  left:650px;
  height: 250px;
}

.slice {
   font-size: 11pt;
   font-family: Verdana;
   fill: white;
      }

.tooltip {
  font-size:12pt;
  font-family: Verdana;

}

/*for line chart*/
.axis path, .axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
}

.line {
  fill: none;
  /*stroke: steelblue;*/
  stroke-width: 3px;
}

.dot {
  /*fill: white;*/
  /*stroke: steelblue;*/
  stroke-width: 1.5px;
  }

.axis text {
    font-family: Verdana;
    font-size: 14px;
}

.title {
  font-family: Verdana;
    font-size: 15px;
    text-align: center;
    padding-left: 10px;
    color: #404040;
}

.xAxis {
    font-family: verdana;
    font-size: 11px;
    fill: black;
}

.yAxis {
    font-family: verdana;
    font-size: 11px;
    fill: white;
}

table {
  border-collapse:collapse;
  border: 0px;
  font-family: Verdana;
  color: #5C5558;
  font-size: 12px;
  text-align: right;
}

td {
  padding-left: 10px;
}

#lineChartTitle1 {
  font-family: Verdana;
  font-size  : 14px;
  fill       : lightgrey;
  font-weight: bold;
  text-anchor: middle;
}

#lineChartTitle2 {
  font-family: Verdana;
  font-size  : 72px;
  fill       : grey;
  text-anchor: middle;
  font-weight: bold;
  /*font-style: italic;*/
}

#button1:hover{
   border: none;
   height: 25px;
   font-size:12px;
   font-weight: bold;
   border-radius: 4px;
   color: white;
   background-color: grey;
}

  </style>

  <style>
    .navbar-default .navbar-nav>.active>a{
      background-color:white;
      color: #00abe0;
      font-weight: bolder;
    }
    .navbar-default .navbar-nav>li>a{
      color: white;
      font-weight: bolder;
    }
    .navbar-default .navbar-nav>.active>a:hover, .navbar-default .navbar-nav>.active>a:focus{
      background-color:white !important;
      display: block;
    }
    .navbar-default .navbar-nav>li>a:hover {
      background-color:white !important;
      display: block;
      color: #00abe0;
      font-weight: bolder;
    }
    .first{
      background-color:white;
    }
    .title>a{
      font-size:10pt;
      font-weight:bolder;
      line-height:2;
      color: black !important;
    }
  </style>

  </head>
  <body>
    <div class="container-fluid">
    <div class="row">
      <div class="col-md-12" style="background-color:#00abe0;border-bottom:solid 1px white;">
        <center>
       <img src="../image/vizbike-transparent.png" class="img-responsive" style="width:25%;">
     </center>

      </div>
    </div>
  </div>


  <nav class="navbar navbar-default" role="navigation" style="background-color:#00abe0; border:none; border-radius:0;margin:0px;">
    <div class="container-fluid" style="padding-left:0px;">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#" style="padding:0px;"></a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="padding-left:0px;">
        <ul class="nav navbar-nav">
          <li><a href="../home.html">Home</a></li>
          <li><img src="../image/explore.png" style="width:100px;padding-top:5px;margin-left:10px;margin-right:10px"/></li>
          <li><img src="../image/newbike.png" style="width:50px"/></li>
          <li><span style="font-size:14pt;font-weight:bolder;line-height:2;margin-right:10px;color:black;">By Rider Behavior</span></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Trip Counts and Duration<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="../tripDuration/ave_num_of_trips.html">Average Trip Counts</a></li>
              <li><a href="../tripDuration/trip_duration.html">Trip Duration</a></li>
            </ul>
          </li>
          <li class=""><a href="../heatmap/heatmap.html">Busy Hours</a></li>
          <li class="active"><a href="../dashboard/weather.html">Weather Impact</a></li>
          <li><img src="../image/index-marker.png" style="width:45px;height:45px;padding-top:5px;"/></li>
          <li><span style="font-size:14pt;font-weight:bolder;line-height:2;margin-right:10px;color:black;">By Station</span></li>
          <li class=""><a href="../map/map.html">Bike Balance</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hot Stations<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="../chorddiagram/chorddiagram.html">Station Path</a></li>
              <li><a href="../bumpchart/bumpchart.html">Station Ranking</a></li>
            </ul>
          </li>


        </ul>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>


    <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <!-- 代码放这里 -->
        <center><h1 style="font-size:24pt; font-weight:bold; color:dark gray;">Weather Impact on Bike Rides</h1></center>
        <center><h3 style="font-size:10pt;color:gray;"><span style="font-weight: bold; color:skyblue;">Click on a pie chart slice</span> to show total rides and average ride count in four weather phenomena in the chosen quarter. </h3></center>
        <center><h3 style="font-size:10pt; color:gray;"><span style="font-weight: bold; color:skyblue;">Click on Overall Distribution button</span> to show overall total rides and overall average ride count in four weather phenomena. </h3></center>

        <div class="legend">
              <span style = "color: #deb95e">&#9638;</span>&nbsp;2015 Quarter 3&nbsp;<br/>
              <span style = "color: #62a9e3">&#9638;</span>&nbsp;2015 Quarter 4&nbsp;<br/>
              <span style = "color: #a6d96e">&#9638;</span>&nbsp;2016 Quarter 1&nbsp;<br/>
              <span style = "color: #d7191a">&#9638;</span>&nbsp;2016 Quarter 2&nbsp;<br/>
              <button id="button1" style="border: none; height: 25px;font-size:12px; font-weight: bold; border-radius: 4px; line-height:1px;" onClick="window.location.reload();">Overall Distribution</button>
          </div>

          <div id="pieChart"></div>
          <div id="barChart"></div>
          <div id="lineChart"></div>
      </div>
    </div>
  </div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="../js/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../js/bootstrap.min.js"></script>
    <script src="http://d3js.org/d3.v2.js"></script>
    <script type="text/javascript">

/*
################ FORMATS ##################
-------------------------------------------
*/

var formatAsPercentage = d3.format("%"),
  formatAsPercentage1Dec = d3.format(".1%"),
  formatAsInteger = d3.format(","),
  fsec = d3.time.format("%S s"),
  fmin = d3.time.format("%M m"),
  fhou = d3.time.format("%H h"),
  fwee = d3.time.format("%a"),
  fdat = d3.time.format("%d d"),
  fmon = d3.time.format("%b")
  ;

/*
############# PIE CHART ###################
-------------------------------------------
*/

function dsPieChart(){

  var dataset = [
      {category: "2015 Q3", measure: 0.44},
        {category: "2015 Q4", measure: 0.18},
        {category: "2016 Q1", measure: 0.10},
        {category: "2016 Q2", measure: 0.28},
        ]
        ;

  var width = 400,
    height = 400,
    outerRadius = Math.min(width, height) / 2,
    innerRadius = outerRadius * .999,
      // for animation
      innerRadiusFinal = outerRadius * .5,
      innerRadiusFinal3 = outerRadius* .45,
      color = ["#deb95e", "#62a9e3", "#a6d96e", "#d7191a"];
      ;

  var vis = d3.select("#pieChart")
      .append("svg:svg")    //create the SVG element inside the <body>
      .data([dataset])      //associate our data with the document
      .attr("width", width)   //set the width and height of our visualization (these will be attributes of the <svg> tag
      .attr("height", height)
      .append("svg:g")      //make a group to hold our pie chart
      .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")")    //move the center of the pie chart from 0, 0 to radius, radius
    ;

   var arc = d3.svg.arc()     //this will create <path> elements for us using arc data
      .outerRadius(outerRadius).innerRadius(innerRadius);

   // for animation
   var arcFinal = d3.svg.arc().innerRadius(innerRadiusFinal).outerRadius(outerRadius);
   var arcFinal3 = d3.svg.arc().innerRadius(innerRadiusFinal3).outerRadius(outerRadius);

   var pie = d3.layout.pie()           //this will create arc data for us given a list of values
        .value(function(d) { return d.measure; });    //we must tell it out to access the value of each element in our data array

   var arcs = vis.selectAll("g.slice")     //this selects all <g> elements with class slice (there aren't any yet)
        .data(pie)          //associate the generated pie data (an array of arcs, each having startAngle, endAngle and value properties)
        .enter()                            //this will create <g> elements for every "extra" data element that should be associated with a selection. The result is creating a <g> for every object in the data array
        .append("svg:g")                //create a group to hold each slice (we will have a <path> and a <text> element associated with each slice)
            .attr("class", "slice")    //allow us to style things in the slices (like text)
            .on("mouseover", mouseover)
        .on("mouseout", mouseout)
        .on("click", up)
        ;

    arcs.append("svg:path")
        .attr("fill", function(d, i) { return color[i]; } ) //set the color for each slice to be chosen from the color function defined above
        .attr("d", arc)     //this creates the actual SVG path using the associated data (pie) with the arc drawing function
    .append("svg:title") //mouseover title showing the figures
    .text(function(d) { return d.data.category + ": " + formatAsPercentage(d.data.measure); });

    d3.selectAll("g.slice").selectAll("path").transition()
      .duration(750)
      .delay(10)
      .attr("d", arcFinal )
      ;

    // Add a label to the larger arcs, translated to the arc centroid and rotated.
    // source: http://bl.ocks.org/1305337#index.html
    arcs.filter(function(d) { return d.endAngle - d.startAngle > .2; })
      .append("svg:text")
        .attr("dy", ".35em")
          .attr("text-anchor", "middle")
          .attr("transform", function(d) { return "translate(" + arcFinal.centroid(d) + ")rotate(" + angle(d) + ")"; })
          //.text(function(d) { return formatAsPercentage(d.value); })
          .text(function(d) { return d.data.category; })
          ;

    // Computes the label angle of an arc, converting from radians to degrees.
  function angle(d) {
      var a = (d.startAngle + d.endAngle) * 90 / Math.PI - 90;
      return a > 90 ? a - 180 : a;
  }

    vis.append("svg:image")
      .attr("xlink:href", "img/spring.png")
        .attr("x", "-100")
        .attr("y", "-160")
        .attr("width", "50")
        .attr("height", "45")
        ;

    vis.append("svg:image")
      .attr("xlink:href", "img/summer.png")
        .attr("x", "-70")
        .attr("y", "120")
        .attr("width", "50")
        .attr("height", "50")
        ;

    vis.append("svg:image")
      .attr("xlink:href", "img/autumn.png")
        .attr("x", "130")
        .attr("y", "-30")
        .attr("width", "50")
        .attr("height", "50")
        ;

    vis.append("svg:image")
      .attr("xlink:href", "img/winter.png")
        .attr("x", "-180")
        .attr("y", "-55")
        .attr("width", "50")
        .attr("height", "50")
        ;

  // Pie chart title
  vis.append("svg:text")
      .attr("dy", ".35em")
      .attr("id","title1")
        .attr("text-anchor", "middle")
        //.text(function(d) {return formatAsPercentage(d.data.measure);})
        .text("Quarterly Rides Distribution")
        //.text(function(d) { return d.data.category + ": " + formatAsPercentage(d.data.measure); })

        ;

  function mouseover() {
      d3.select(this).select("path").transition()
          .duration(750)
            //.attr("stroke","red")
            //.attr("stroke-width", 1.5)
            .attr("d", arcFinal3)
            ;
  }

  function mouseout() {
      d3.select(this).select("path").transition()
          .duration(750)
              //.attr("stroke","blue")
              //.attr("stroke-width", 1.5)
              .attr("d", arcFinal)
              ;
  }

  function up(d, i) {
    /* update bar chart when user selects piece of the pie chart */
    //updateBarChart(dataset[i].category);
    updateBarChart(d.data.category, color[i]);
    updateLineChart(d.data.category, color[i]);
  }

  // var div = d3.select("#pieChart").append("div").attr("class", "tooltip");

 //     arcs
 //        .on("mousemove", function(d){
 //            div.style("left", d3.event.pageX+10+"px");
 //            div.style("top", d3.event.pageY-25+"px");
 //            div.style("display", "inline-block");
 //            div.html((d.data.label)+"<br>"+(d.data.value)+"%");
 //        });
 //    arcs
 //        .on("mouseout", function(d){
 //            div.style("display", "none");
 //        });

 //    arcs.exit()
 //        .remove();


}

dsPieChart();


/*
############# BAR CHART ###################
-------------------------------------------
*/

var datasetBarChart = [
{ group: "All", category: "Sunny", measure: 305 },
{ group: "All", category: "Mist", measure: 260 },
{ group: "All", category: "Rain", measure: 204 },
{ group: "All", category: "Snow", measure: 43 },
{ group: "2015 Q3", category: "Sunny", measure: 498 },
{ group: "2015 Q3", category: "Mist", measure: 440 },
{ group: "2015 Q3", category: "Rain", measure: 353 },
{ group: "2015 Q3", category: "Snow", measure: 0 },
{ group: "2015 Q4", category: "Sunny", measure: 198 },
{ group: "2015 Q4", category: "Mist", measure: 221 },
{ group: "2015 Q4", category: "Rain", measure: 142 },
{ group: "2015 Q4", category: "Snow", measure: 59 },
{ group: "2016 Q1", category: "Sunny", measure: 162 },
{ group: "2016 Q1", category: "Mist", measure: 57 },
{ group: "2016 Q1", category: "Rain", measure: 95 },
{ group: "2016 Q1", category: "Snow", measure: 37 },
{ group: "2016 Q2", category: "Sunny", measure: 362 },
{ group: "2016 Q2", category: "Mist", measure: 320 },
{ group: "2016 Q2", category: "Rain", measure: 224 },
{ group: "2016 Q2", category: "Snow", measure: 75 },
]
;

// set initial group value
var group = "All";

function datasetBarChosen(group) {
  var ds = [];
  for (x in datasetBarChart) {
    if(datasetBarChart[x].group==group){
      ds.push(datasetBarChart[x]);
    }
  }
  return ds;
}

function dsBarChartBasics() {
  var margin = {top: 30, right: 5, bottom: 20, left: 50},
  width = 500 - margin.left - margin.right,
    height = 250 - margin.top - margin.bottom,
  colorBar = d3.scale.category20(),
  barPadding = 1
  ;

  return {
    margin : margin,
    width : width,
    height : height,
    colorBar : colorBar,
    barPadding : barPadding
  }
  ;
}

function dsBarChart() {

  var firstDatasetBarChart = datasetBarChosen(group);

  var basics = dsBarChartBasics();

  var margin = basics.margin,
    width = basics.width,
      height = basics.height,
    colorBar = basics.colorBar,
    barPadding = basics.barPadding
    ;

  var xScale = d3.scale.linear()
    .domain([0, firstDatasetBarChart.length])
    .range([0, width])
    ;

  // Create linear y scale
  // Purpose: No matter what the data is, the bar should fit into the svg area; bars should not
  // get higher than the svg height. Hence incoming data needs to be scaled to fit into the svg area.
  var yScale = d3.scale.linear()
    // use the max funtion to derive end point of the domain (max value of the dataset)
    // do not use the min value of the dataset as min of the domain as otherwise you will not see the first bar
     .domain([0, d3.max(firstDatasetBarChart, function(d) { return d.measure; })])
     // As coordinates are always defined from the top left corner, the y position of the bar
     // is the svg height minus the data value. So you basically draw the bar starting from the top.
     // To have the y position calculated by the range function
     .range([height, 0])
     ;

  //Create SVG element
  var svg = d3.select("#barChart")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom + 50)
        .attr("id","barChartPlot")
        ;

  var plot = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        ;

  plot.selectAll("rect")
       .data(firstDatasetBarChart)
       .enter()
       .append("rect")
      .attr("x", function(d, i) {
          return xScale(i);
      })
       .attr("width", width / firstDatasetBarChart.length - barPadding)
      .attr("y", function(d) {
          return yScale(d.measure);
      })
      .attr("height", function(d) {
          return height-yScale(d.measure);
      })
      .attr("fill", "grey")
      ;

  // Add y labels to plot

  plot.selectAll("text")
    .data(firstDatasetBarChart)
    .enter()
    .append("text")
    .text(function(d) {
        return formatAsInteger(d3.round(d.measure));
  })

  .attr("text-anchor", "middle")
  // Set x position to the left edge of each bar plus half the bar width
  .attr("x", function(d, i) {
      return (i * (width / firstDatasetBarChart.length)) + ((width / firstDatasetBarChart.length - barPadding) / 2);
  })
  .attr("y", function(d) {
      return yScale(d.measure) + 14;
  })
  .attr("class", "yAxis")
  /* moved to CSS
  .attr("font-family", "sans-serif")
  .attr("font-size", "11px")
  .attr("fill", "white")
  */
  ;

  // Add x labels to chart
  var xLabels = svg
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + (margin.top + height)  + ")")
      ;

  xLabels.selectAll("text.xAxis")
      .data(firstDatasetBarChart)
      .enter()
      .append("text")
      .text(function(d) { return d.category;})
      .attr("text-anchor", "middle")
    // Set x position to the left edge of each bar plus half the bar width
      .attr("x", function(d, i) {
        return (i * (width / firstDatasetBarChart.length)) + ((width / firstDatasetBarChart.length - barPadding) / 2);
      })
      .attr("y", 40)
      .attr("class", "xAxis")
      //.attr("style", "font-size: 12; font-family: Helvetica, sans-serif")
      ;

  // Title
  svg.append("text")
    .attr("x", (width + margin.left + margin.right)/2 + 22)
    .attr("y", 12)
    .attr("class","title")
    .attr("text-anchor", "middle")
    .text("Overall Average Ride Count in Four Weather Phenomena")
    ;

    var img1 = svg.selectAll("img").data([0]);
        img1.enter()
        .append("svg:image")
        .attr("xlink:href", "img/sunnyNew.png")
        .attr("x", "90")
        .attr("y", "233")
        .attr("width", "30")
        .attr("height", "30");

    var img2 = svg.selectAll("img").data([0]);
        img2.enter()
        .append("svg:image")
        .attr("xlink:href", "img/mistNew.png")
        .attr("x", "197")
        .attr("y", "233")
        .attr("width", "40")
        .attr("height", "30");

    var img3 = svg.selectAll("img").data([0]);
        img3.enter()
        .append("svg:image")
        .attr("xlink:href", "img/rainNew.png")
        .attr("x", "308")
        .attr("y", "233")
        .attr("width", "40")
        .attr("height", "30");

    var img4 = svg.selectAll("img").data([0]);
        img4.enter()
        .append("svg:image")
        .attr("xlink:href", "img/snowNew.png")
        .attr("x", "425")
        .attr("y", "233")
        .attr("width", "30")
        .attr("height", "30");

}

dsBarChart();

 /* ** UPDATE CHART ** */

/* updates bar chart on request */

function updateBarChart(group, colorChosen) {

  var currentDatasetBarChart = datasetBarChosen(group);

  var basics = dsBarChartBasics();

  var margin = basics.margin,
    width = basics.width,
      height = basics.height,
    colorBar = basics.colorBar,
    barPadding = basics.barPadding
    ;

  var xScale = d3.scale.linear()
    .domain([0, currentDatasetBarChart.length])
    .range([0, width])
    ;

  var yScale = d3.scale.linear()
        .domain([0, d3.max(currentDatasetBarChart, function(d) { return d.measure; })])
        .range([height,0])
        ;

   var svg = d3.select("#barChart svg");

   var plot = d3.select("#barChartPlot")
        .datum(currentDatasetBarChart)
      ;

      /* Note that here we only have to select the elements - no more appending! */
      plot.selectAll("rect")
        .data(currentDatasetBarChart)
        .transition()
        .duration(750)
        .attr("x", function(d, i) {
            return xScale(i);
        })
          .attr("width", width / currentDatasetBarChart.length - barPadding)
        .attr("y", function(d) {
            return yScale(d.measure);
        })
        .attr("height", function(d) {
            return height-yScale(d.measure);
        })
        .attr("fill", colorChosen)
        ;

    plot.selectAll("text.yAxis") // target the text element(s) which has a yAxis class defined
      .data(currentDatasetBarChart)
      .transition()
      .duration(750)
        .attr("text-anchor", "middle")
        .attr("x", function(d, i) {
          return (i * (width / currentDatasetBarChart.length)) + ((width / currentDatasetBarChart.length - barPadding) / 2);
        })
        .attr("y", function(d) {
          return yScale(d.measure) + 14;
        })
        .text(function(d) {
        return formatAsInteger(d3.round(d.measure));
        })
        .attr("class", "yAxis")
    ;

    svg.selectAll("text.title") // target the text element(s) which has a title class defined
      .attr("x", (width + margin.left + margin.right)/2 + 22)
      .attr("y", 12)
      .attr("class","title")
      .attr("text-anchor", "middle")
      .text(group + "'s Average Ride Count in Four Weather Phenomena")
    ;
}


/*
############# LINE CHART ##################
-------------------------------------------
*/

var datasetLineChart = [
{ group: "All", category: "Snow", measure: 90074 },
{ group: "2015 Q3", category: "Mist", measure: 40079},
{ group: "2015 Q4", category: "Snow", measure: 16207 },
{ group: "2016 Q1", category: "Snow", measure: 9523 },
{ group: "2016 Q2", category: "Snow", measure: 24965 },
]
;

function datasetLineChartChosen(group) {
  var ds = [];
  for (x in datasetLineChart) {
     if(datasetLineChart[x].group==group){
      ds.push(datasetLineChart[x]);
     }
    }
  return ds;
}

function dsLineChartBasics() {

  var margin = {top: 20, right: 10, bottom: 0, left: 50},
      width = 500 - margin.left - margin.right,
      height = 150 - margin.top - margin.bottom
      ;

  return {
    margin : margin,
    width : width,
    height : height
  }
  ;
}

function dsLineChart() {
  var firstDatasetLineChart = datasetLineChartChosen(group);

  var basics = dsLineChartBasics();

  var margin = basics.margin,
    width = basics.width,
     height = basics.height
    ;

  var xScale = d3.scale.linear()
      .domain([0, firstDatasetLineChart.length-1])
      .range([0, width])
      ;

  var yScale = d3.scale.linear()
      .domain([0, d3.max(firstDatasetLineChart, function(d) { return d.measure; })])
      .range([height, 0])
      ;

  var line = d3.svg.line()
      //.x(function(d) { return xScale(d.category); })
      .x(function(d, i) { return xScale(i); })
      .y(function(d) { return yScale(d.measure); })
      ;

  var svg = d3.select("#lineChart").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)

  var plot = svg
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      .attr("id", "lineChartPlot")
      ;

  /* descriptive titles as part of plot -- start */
  var dsLength=firstDatasetLineChart.length;

  plot.append("text")
    .text(firstDatasetLineChart[dsLength-1].measure)
    .attr("id","lineChartTitle2")
    .attr("x",width/2)
    .attr("y",height/2)
    ;
  /* descriptive titles -- end */

  svg.append("text")
    .text("Overall Total Rides")
    .attr("id","lineChartTitle1")
    .attr("x",margin.left + ((width + margin.right)/2))
    .attr("y", 11)
    ;
}

dsLineChart();

/* updates line chart on request */
function updateLineChart(group, colorChosen) {

  var currentDatasetLineChart = datasetLineChartChosen(group);

  var basics = dsLineChartBasics();

  var margin = basics.margin,
    width = basics.width,
      height = basics.height
    ;

  var xScale = d3.scale.linear()
      .domain([0, currentDatasetLineChart.length-1])
      .range([0, width])
      ;

  var yScale = d3.scale.linear()
      .domain([0, d3.max(currentDatasetLineChart, function(d) { return d.measure; })])
      .range([height, 0])
      ;

  var line = d3.svg.line()
      .x(function(d, i) { return xScale(i); })
      .y(function(d) { return yScale(d.measure); })
      ;

   var plot = d3.select("#lineChartPlot")
      .datum(currentDatasetLineChart)
      ;

  /* descriptive titles as part of plot -- start */
  var dsLength=currentDatasetLineChart.length;

  plot.select("text")
    .text(currentDatasetLineChart[dsLength-1].measure)
    ;
  /* descriptive titles -- end */

  var svg = d3.select("#lineChart svg");

  svg.selectAll("text#lineChartTitle1")
    .text(group + "'s Total Rides")
    .attr("id","lineChartTitle1")
    .attr("x",margin.left + ((width + margin.right)/2))
    .attr("y", 11)
    ;


  path.selectAll("title")
     .text(function(d) { return d.category + ": " + formatAsInteger(d.measure); })
     ;

}

</script>


  </body>
</html>
